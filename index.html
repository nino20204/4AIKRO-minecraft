<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STORE 4AIKRO</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-1P984G5247"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-1P984G5247');
    </script>

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Tajawal:wght@500;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #00e676;
            --secondary-color: #4CAF50;
            --bg-dark: #0a0a0a;
            --bronze-color: #cd7f32;
            --glass: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --online-color: #22c55e;
            --offline-color: #ef4444;
            --rarity-common: #ffffff;
            --rarity-rare: #5555ff;
        }

        body {
            font-family: 'Cairo', sans-serif;
            margin: 0; padding: 0;
            background-color: var(--bg-dark); color: white;
            overflow-x: hidden; min-height: 100vh;
        }

        .bg-animation {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(45deg, #0a0a0a, #1a1a1a, #0f3d1f, #0a0a0a);
            background-size: 400% 400%; animation: gradientBG 15s ease infinite; z-index: -1;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
        .global-user-bar {
            position: fixed; top: 0; left: 0; width: 100%;
            background: rgba(0, 0, 0, 0.9); backdrop-filter: blur(15px);
            padding: 12px 20px; display: flex; justify-content: space-between; align-items: center;
            z-index: 1000; border-bottom: 1px solid var(--glass-border);
            flex-wrap: wrap; gap: 10px; box-sizing: border-box;
        }
        
        .brand-logo { 
            font-family: 'Tajawal', sans-serif; 
            font-size: 1.6em; 
            font-weight: 900; 
            background: linear-gradient(to right, #fff, #00e676); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent; 
            white-space: nowrap; 
            flex-shrink: 0;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
            cursor: pointer; transition: 0.3s;
        }
        .brand-logo:hover { transform: scale(1.05); }
        
        .auth-actions { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; align-items: center; }
        
        .user-btn {
            background: var(--glass); color: white; border: 1px solid var(--glass-border);
            padding: 8px 18px; border-radius: 12px; cursor: pointer; font-family: 'Cairo', sans-serif;
            transition: 0.3s; font-size: 0.9em; display: flex; align-items: center; gap: 8px; position: relative; overflow: hidden;
            font-weight: bold; text-decoration: none;
        }
        .user-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: var(--primary-color); transform: translateY(-2px); }
        
        .user-btn.profile-btn { background: rgba(76, 175, 50, 0.15); border: 1px solid rgba(76, 175, 50, 0.5); }
        .user-btn.profile-btn:hover { background: rgba(76, 175, 50, 0.3); }
        
        .user-btn.logout-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.85em; padding: 6px 12px; }
        .user-btn.logout-btn:hover { background: rgba(239, 68, 68, 0.2); border-color: #ef4444; color: #ef4444; }

        .key-badge { background: var(--bronze-color); color: white; padding: 2px 6px; border-radius: 20px; font-size: 0.8em; }

        /* ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± */
        #landing-page { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; text-align: center; padding: 100px 20px 50px 20px; }
        
        .landing-logo { 
            width: 120px; height: 120px; border-radius: 50%; object-fit: cover; 
            border: 4px solid var(--primary-color); box-shadow: 0 0 30px rgba(0, 230, 118, 0.4); 
            margin-bottom: 20px; 
            animation: pulseLogo 3s infinite, float 6s ease-in-out infinite; 
        }
        @keyframes pulseLogo { 0% { box-shadow: 0 0 20px rgba(0, 230, 118, 0.2); } 50% { box-shadow: 0 0 40px rgba(0, 230, 118, 0.6); } 100% { box-shadow: 0 0 20px rgba(0, 230, 118, 0.2); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-15px); } }

        .landing-title { font-family: 'Tajawal', sans-serif; font-size: 3em; margin-bottom: 10px; background: linear-gradient(135deg, #ffffff, #00e676); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-transform: uppercase; letter-spacing: 1px; }
        .landing-subtitle { font-size: 1.1em; color: #aaa; margin-bottom: 40px; }
        .choices-container { display: flex; gap: 30px; flex-wrap: wrap; justify-content: center; width: 100%; max-width: 800px; }
        
        .choice-card {
            width: 100%; max-width: 320px; height: auto; min-height: 380px;
            background: var(--glass); backdrop-filter: blur(15px);
            border-radius: 25px; cursor: pointer; transition: 0.5s cubic-bezier(0.23, 1, 0.320, 1);
            border: 2px solid var(--glass-border); position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); padding: 20px;
        }
        .choice-card:hover { transform: translateY(-10px) scale(1.02); border-color: var(--primary-color); box-shadow: 0 0 30px rgba(0, 230, 118, 0.2); }
        .choice-card img { width: 100px; height: 100px; margin-bottom: 15px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); transition: transform 0.5s; }
        .choice-card:hover img { transform: scale(1.1) rotate(5deg); }
        .choice-card h2 { font-size: 1.8em; margin: 0; }
        .choice-card p { color: #ccc; margin-top: 10px; padding: 0 10px; }

        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ */
        #minecraft-page, #roblox-page { display: none; }
        .container { width: 95%; max-width: 1400px; margin: 90px auto 30px auto; background: rgba(20, 20, 20, 0.6); backdrop-filter: blur(10px); padding: 25px; border-radius: 20px; border: 1px solid var(--glass-border); position: relative; }
        .back-btn { position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.1); font-size: 0.85em; padding: 6px 12px; }

        /* Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ */
        .modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.95); backdrop-filter: blur(8px); overflow-y: auto; }
        .modal-content { 
            background: linear-gradient(145deg, #1e1e1e, #111); 
            margin: 5% auto; padding: 40px 30px; border-radius: 24px; width: 90%; max-width: 420px; 
            border: 1px solid #333; text-align: center; position: relative; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); animation: modalFadeIn 0.3s ease;
        }
        @keyframes modalFadeIn { from { transform: translateY(-50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-content h2 { margin-top: 0; color: var(--primary-color); margin-bottom: 25px; font-size: 1.6em; font-weight: 900; }
        .modal-content input { 
            width: 100%; padding: 15px; margin: 10px 0; border-radius: 12px; 
            border: 2px solid #333; background: #0a0a0a; color: white; 
            font-family: 'Cairo', sans-serif; text-align: center; font-size: 1em; box-sizing: border-box; 
            transition: 0.3s;
        }
        .modal-content input:focus { border-color: var(--primary-color); outline: none; background: #111; }
        .close-btn { position: absolute; top: 15px; left: 15px; font-size: 28px; cursor: pointer; color: #444; transition: 0.3s; }
        .close-btn:hover { color: #fff; }
        .modal-link { font-size: 0.85em; color: var(--primary-color); cursor: pointer; margin-top: 15px; display: block; opacity: 0.8; }
        .modal-link:hover { opacity: 1; text-decoration: underline; }
        
        /* Header */
        header {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 15px; padding: 50px 20px; border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 25px; text-align: center;
        }
        .animated-gif { width: 150px; border-radius: 10px; box-shadow: 0 0 30px rgba(76, 175, 50, 0.5); border: 3px solid rgba(255,255,255,0.1); transition: transform 0.3s; }
        .animated-gif:hover { transform: scale(1.05); }
        .header-text { display: flex; flex-direction: column; align-items: center; gap: 8px; }
        header h1 { color: #fff; margin: 0; font-size: 2.4em; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 0 15px var(--primary-color); line-height: 1.2; font-family: 'Tajawal', sans-serif; }
        header p { margin: 0; color: #ccc; font-size: 0.9em; background: rgba(255, 255, 255, 0.1); padding: 4px 12px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); letter-spacing: 1px; }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª */
        .balance-display { background: rgba(0,0,0,0.3); padding: 6px; border-radius: 8px; margin-bottom: 8px; border: 1px solid rgba(205, 127, 50, 0.3); display: flex; justify-content: center; align-items: center; gap: 8px; font-size: 0.85em; }
        .balance-count { font-size: 1.2em; font-weight: 900; color: var(--bronze-color); }
        
        .section { margin-bottom: 30px; opacity: 0; transform: translateY(50px); transition: all 0.8s ease; }
        .section.visible { opacity: 1; transform: translateY(0); }
        
        .section h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 8px; color: #fff; font-size: 1.5em; display: inline-block; margin-bottom: 15px; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; align-items: start; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 15px; text-align: center; border: 1px solid #333; transition: 0.3s; display: flex; flex-direction: column; justify-content: space-between; height: 100%; box-sizing: border-box; overflow: hidden; }
        .card:hover { transform: translateY(-3px); border-color: var(--primary-color); box-shadow: 0 10px 20px rgba(0,0,0,0.4); }
        .rank-image { width: 100%; height: 110px; object-fit: contain; margin-bottom: 10px; transition: transform 0.3s; }
        .card:hover .rank-image { transform: scale(1.05); }
        
        .btn { 
            display: inline-block; background: linear-gradient(135deg, #4CAF50, #2E7D32); color: white; 
            padding: 10px 25px; text-decoration: none; border-radius: 50px; transition: 0.3s; 
            border: none; cursor: pointer; font-size: 0.95em; font-family: 'Cairo', sans-serif; font-weight: bold; 
            position: relative; overflow: hidden; margin-top: 5px;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(76, 175, 50, 0.4); }
        .btn-bronze { background: linear-gradient(135deg, #cd7f32, #8b4513); }
        .btn-rules { background: linear-gradient(135deg, #555, #333); border: 1px solid #444; }
        
        .server-status { 
            padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2); 
            box-shadow: 0 0 20px rgba(0,0,0,0.4); 
            position: relative; overflow: hidden; color: #fff;
            background-image: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0.8)), url('https://wallpapercave.com/wp/wp9336459.jpg');
            background-size: cover; background-position: center;
        }
        .server-status::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); z-index: 0; }
        .server-status > * { position: relative; z-index: 1; }

        .ip-box { background: rgba(51, 65, 85, 0.8); padding: 10px 20px; border-radius: 50px; display: inline-block; cursor: pointer; transition: 0.3s; border: 1px solid #475569; font-weight: bold; font-size: 0.9em; margin-top: 10px; }
        .ip-box:hover { background: var(--secondary-color); border-color: var(--secondary-color); }

        .status-text { font-size: 22px; font-weight: bold; transition: all 0.5s ease; }
        .status-online { color: var(--online-color); text-shadow: 0 0 8px rgba(34, 197, 94, 0.6); animation: glowGreen 2s ease-in-out infinite alternate; }
        .status-offline { color: var(--offline-color); text-shadow: 0 0 8px rgba(239, 68, 68, 0.6); animation: glowRed 2s ease-in-out infinite alternate; }
        
        .item-image { width: 100%; height: 110px; object-fit: contain; background: linear-gradient(135deg, #1a1a1a, #252525); border-radius: 8px; margin-bottom: 10px; padding: 5px; display: block; margin-left: auto; margin-right: auto; border: 1px solid rgba(255, 255, 255, 0.05); transition: transform 0.3s ease; }
        .card:hover .item-image { transform: scale(1.02); }

        #scrollTopBtn { display: none; position: fixed; bottom: 30px; left: 30px; z-index: 1500; border: none; outline: none; background: var(--primary-color); color: #000; cursor: pointer; padding: 15px; border-radius: 50%; font-size: 18px; box-shadow: 0 5px 15px rgba(0,230,118,0.3); transition: 0.3s; }
        #scrollTopBtn:hover { background: #fff; transform: scale(1.1); }

        /* === Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† === */
        .inventory-modal-content { max-width: 900px; background: #0a0a0a; border: 1px solid #333; text-align: right; padding: 0; display: flex; flex-direction: column; height: 80vh; }
        .inv-header { padding: 15px 20px; background: linear-gradient(to left, #1a1a1a, #0f3d1f); display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .inv-header h2 { margin: 0; font-size: 1.2em; display: flex; align-items: center; gap: 10px; }
        .inv-body { display: flex; flex: 1; overflow: hidden; }
        .inv-grid { flex: 2; padding: 15px; display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; overflow-y: auto; background: #0f0f0f; border-left: 1px solid #222; }
        .inv-slot { aspect-ratio: 1; background: #1a1a1a; border: 2px solid #333; border-radius: 8px; cursor: pointer; position: relative; transition: 0.2s; display: flex; align-items: center; justify-content: center; padding: 5px; }
        .inv-slot:hover { border-color: #fff; transform: scale(1.05); z-index: 2; }
        .inv-slot.selected { border-color: var(--primary-color); box-shadow: 0 0 15px rgba(0, 230, 118, 0.3); }
        .inv-slot img { width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5)); }
        .inv-slot .item-count { position: absolute; bottom: 2px; left: 2px; background: rgba(0,0,0,0.8); font-size: 0.7em; padding: 1px 4px; border-radius: 4px; font-weight: bold; }
        
        .rarity-common { border-color: #555; box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.05); }
        .rarity-rare { border-color: var(--rarity-rare); box-shadow: inset 0 0 10px rgba(85, 85, 255, 0.2); }
        
        .inv-details { flex: 1; padding: 20px; background: #111; display: flex; flex-direction: column; align-items: center; text-align: center; overflow-y: auto; }
        .inv-details img { width: 80px; height: 80px; object-fit: contain; margin-bottom: 15px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.5)); }
        .inv-details h3 { margin: 0 0 5px 0; font-size: 1.1em; color: #fff; }
        .inv-details .rarity-text { font-size: 0.8em; font-weight: bold; margin-bottom: 10px; text-transform: uppercase; }
        .inv-details p { font-size: 0.85em; color: #aaa; line-height: 1.4; margin: 0; }
        .inv-empty-msg { color: #444; text-align: center; margin-top: 50%; font-size: 0.9em; }

        /* Referral Box */
        .referral-box {
            margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3);
            border-radius: 10px; border: 1px dashed #444; width: 100%; box-sizing: border-box;
        }
        .referral-title { font-size: 0.9em; color: var(--primary-color); margin-bottom: 8px; display: block; }
        .referral-link-display {
            display: flex; gap: 5px; justify-content: center; align-items: center;
        }
        .referral-link-input {
            flex: 1; background: #0a0a0a; border: 1px solid #333; padding: 8px;
            border-radius: 6px; color: #fff; font-size: 0.8em; text-align: center;
            pointer-events: none;
        }
        .referral-copy-btn {
            background: var(--bronze-color); border: none; padding: 8px 12px;
            border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 0.8em;
        }
        .referral-info { font-size: 0.75em; color: #666; margin-top: 5px; }

        /* Toast */
        #toast-container {
            position: fixed; bottom: 20px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            background: #1e1e1e; color: white; padding: 12px 20px; border-radius: 8px; border-right: 4px solid var(--primary-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); animation: slideIn 0.3s ease, fadeOut 0.5s ease 2.5s forwards;
            display: flex; align-items: center; gap: 10px; font-size: 0.9em; max-width: 300px;
        }
        .toast.error { border-color: #ef4444; }
        .toast.success { border-color: var(--primary-color); }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes fadeOut { to { opacity: 0; transform: translateX(100%); } }

        @media (max-width: 600px) {
            .brand-logo { font-size: 1.2em; }
            .container { margin: 80px auto 20px auto; padding: 15px; }
            header h1 { font-size: 1.8em; }
            .animated-gif { width: 120px; }
            .rank-image, .item-image { height: 90px; }
            .inv-body { flex-direction: column; }
            .inv-grid { flex: none; height: 150px; overflow-x: auto; display: flex; flex-wrap: nowrap; grid-template-columns: none; }
            .inv-slot { min-width: 70px; }
            #toast-container { left: 20px; right: 20px; bottom: 20px; }
            .toast { width: 100%; justify-content: center; max-width: 100%; }
        }
    </style>
</head>
<body>

<div class="bg-animation"></div>
<button onclick="topFunction()" id="scrollTopBtn" title="Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø£Ø¹Ù„Ù‰">â¬†</button>
<div id="toast-container"></div>

<!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ -->
<div class="global-user-bar">
    <div class="brand-logo" onclick="goHome()">STORE 4AIKRO</div>
    <div id="auth-btn-container" class="auth-actions"></div>
</div>

<!-- 1. Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
<div id="landing-page">
    <img src="newlogosite.gif" alt="Logo" class="landing-logo">
    <h1 class="landing-title">Choose Your Game</h1>
    <p class="landing-subtitle">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„ØªÙŠ ÙŠÙˆÙØ±Ù‡Ø§ STORE 4AIKRO</p>
    <div class="choices-container">
        <div class="choice-card card-roblox" onclick="showPage('roblox')">
            <img src="logoroblox.png" alt="Roblox">
            <h2>ROBLOX</h2>
            <p>Ø¹Ø§Ù„Ù… Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨ Ø§Ù„Ù„Ø§Ù…ØªÙ†Ø§Ù‡ÙŠ</p>
        </div>
        <div class="choice-card card-minecraft" onclick="showPage('minecraft')">
            <img src="logominecraft.png" alt="Minecraft">
            <h2>MINECRAFT</h2>
            <p>Ø³ÙŠØ±ÙØ±Ø§ØªÙ†Ø§ Ø§Ù„Ø±Ø³Ù…ÙŠØ© Ù„Ù…Ø§ÙŠÙ†ÙƒØ±Ø§ÙØª Ø¬Ø§ÙØ§</p>
        </div>
    </div>
</div>

<!-- 2. Ø±ÙˆØ¨Ù„ÙˆÙƒØ³ -->
<div id="roblox-page">
    <div class="container">
        <button class="user-btn back-btn" onclick="goHome()">â¬… Ø§Ù„Ø¹ÙˆØ¯Ø©</button>
        <header><h1>ROBLOX</h1><p>Ù‚Ø±ÙŠØ¨Ø§Ù‹</p></header>
    </div>
</div>

<!-- 3. Ù…Ø§ÙŠÙ†ÙƒØ±Ø§ÙØª -->
<div id="minecraft-page">
    <div class="container">
        <button class="user-btn back-btn" onclick="goHome()">â¬… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
        <header>
            <img src="standard_1.gif" alt="GIF" class="animated-gif">
            <div class="header-text">
                <h1>âš”ï¸ SERVEUR 4AIKRO_S4 âš”ï¸</h1>
                <p>UPDATE: 1</p>
            </div>
        </header>

        <div class="server-status">
            <div class="status-text" id="status-text">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...</div>
            <span class="status-dot" id="status-dot"></span>
            <div class="status-info">
                <div id="player-count"></div>
                <div id="server-version"></div>
            </div>
            <div class="ip-box" onclick="copyIP()"><strong>IP:</strong> <span id="server-ip">cities-declare.gl.joinmc.link</span> ğŸ“‹</div>
        </div>

        <div style="display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
            <a href="https://discord.gg/gMrHAzvERJ" target="_blank" class="btn btn-discord" style="background:#5865F2;">Discord</a>
            <a href="https://www.mediafire.com/file/eyavtrl589c7s5x/mods_serveur_4AIKRO_S4.rar/file" class="btn" target="_blank">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¯Ø§Øª</a>
            <button class="btn btn-rules" onclick="openModal('rules-modal')">âš–ï¸ Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ†</button>
        </div>

        <div class="section">
            <h2>ğŸ’ Ø§Ù„Ø±ØªØ¨ ÙˆØ§Ù„Ù‡Ø¯Ø§ÙŠØ§</h2>
            <div class="card-grid">
                <div class="card">
                    <div>
                        <img src="gift.png" alt="Daily Gift" class="rank-image">
                        <h3>Ø§Ù„Ù‡Ø¯ÙŠØ© Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</h3>
                        <p>Ù‡Ø¯ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ© ÙƒÙ„ 24 Ø³Ø§Ø¹Ø©.</p>
                        <div class="balance-display" id="key-balance-box" style="display:none;">
                            <span>Ø±ØµÙŠØ¯Ùƒ:</span>
                            <span class="balance-count" id="key-balance-num">0</span>
                            <span>Ø¹Ù†ØµØ±</span>
                        </div>
                    </div>
                    <div>
                        <div id="key-display-area" style="display:none; margin-bottom:10px;">
                            <div class="countdown-timer">â³ <span id="timer-display">00:00:00</span></div>
                        </div>
                        <button id="claim-key-btn" class="btn btn-bronze" onclick="claimBronzeKey()">ğŸ”‘ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­Ùƒ</button>
                    </div>
                </div>

                <div class="card">
                    <div>
                        <img src="vip.jpg" alt="VIP" class="rank-image">
                        <h3>Ø±ØªØ¨Ø© VIP</h3>
                        <p>Ù…Ø²Ø§ÙŠØ§ Ø¥Ø¶Ø§ÙÙŠØ©.</p>
                    </div>
                    <div class="price">$2.00</div>
                    <a href="#" class="btn">Ø´Ø±Ø§Ø¡</a>
                </div>

                <div class="card">
                    <div>
                        <img src="mvp.jpg" alt="MVP" class="rank-image">
                        <h3>Ø±ØªØ¨Ø© MVP</h3>
                        <p>ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©.</p>
                    </div>
                    <div class="price">$5.00</div>
                    <a href="#" class="btn">Ø´Ø±Ø§Ø¡</a>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>ğŸ›’ Ù…ØªØ¬Ø± Ø§Ù„Ø¢ÙŠØªÙ…Ø§Øª</h2>
            <div class="card-grid">
                <div class="card">
                    <img src="100coin.jpg" class="item-image">
                    <h3>100 COIN</h3>
                    <div class="price">$1.00</div>
                    <a href="#" class="btn">Ø´Ø±Ø§Ø¡</a>
                </div>
                 <div class="card">
                    <img src="500coin.jpg" class="item-image">
                    <h3>500 COIN</h3>
                    <div class="price">$3.00</div>
                    <a href="#" class="btn">Ø´Ø±Ø§Ø¡</a>
                </div>
                 <div class="card">
                    <img src="1000coin.jpg" class="item-image">
                    <h3>1000 COIN</h3>
                    <div class="price">$5.00</div>
                    <a href="#" class="btn">Ø´Ø±Ø§Ø¡</a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Ù†ÙˆØ§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ -->
<div id="login-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('login-modal')">&times;</span>
        <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
        <input type="text" id="login-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="login-code" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ">
        <button class="btn" onclick="handleLogin()" style="width:100%;">Ø¯Ø®ÙˆÙ„</button>
        <span class="modal-link" onclick="openForgotModal()">Ù†Ø³ÙŠØª ÙƒÙˆØ¯ÙƒØŸ</span>
    </div>
</div>

<div id="forgot-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('forgot-modal')">&times;</span>
        <h2>Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ÙƒÙˆØ¯</h2>
        <p style="font-size:0.85em; color:#888; margin-bottom:15px;">Ø£Ø¯Ø®Ù„ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¨Ù‡ Ù„Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ÙƒÙˆØ¯Ùƒ.</p>
        <input type="email" id="forgot-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <button class="btn" onclick="handleForgot()" style="width:100%;">Ø¨Ø­Ø«</button>
        <span class="modal-link" onclick="closeModal('forgot-modal'); openModal('login-modal');">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</span>
    </div>
</div>

<div id="register-modal" class="modal">
    <div class="modal-content">
        <span class="close-btn" onclick="closeModal('register-modal')">&times;</span>
        <div style="font-size:3em; margin-bottom:10px;">ğŸ“</div>
        <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
        <p style="font-size:0.85em; color:#888; margin-bottom:20px;">Ø£Ù†Ø´Ø¦ Ø­Ø³Ø§Ø¨Ùƒ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø­ØµØ±ÙŠØ©</p>
        <input type="text" id="reg-name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…">
        <input type="password" id="reg-code" placeholder="Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠ">
        <input type="email" id="reg-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹)">
        <button class="btn" onclick="handleRegister()" style="width:100%;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
    </div>
</div>

<!-- Ù…Ø®Ø²ÙˆÙ† Ø§Ø­ØªØ±Ø§ÙÙŠ -->
<div id="inventory-modal" class="modal">
    <div class="modal-content inventory-modal-content">
        <div class="inv-header">
            <h2>ğŸ“¦ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
            <div style="display:flex; gap:10px;">
                <button class="btn logout-btn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
                <span class="close-btn" style="position:relative; top:0; left:0; font-size:20px;" onclick="closeModal('inventory-modal')">&times;</span>
            </div>
        </div>
        <div class="inv-body">
            <div class="inv-grid" id="inv-grid"></div>
            <div class="inv-details" id="inv-details">
                <p class="inv-empty-msg">Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ø§Ù‹ Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„</p>
                <div class="referral-box">
                    <span class="referral-title">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</span>
                    <div class="referral-link-display">
                        <input type="text" id="ref-link-display" class="referral-link-input" readonly>
                        <button class="referral-copy-btn" onclick="copyRefLink()">Ù†Ø³Ø®</button>
                    </div>
                    <p class="referral-info">Ø§Ø¯Ø¹Ù Ø£ØµØ¯Ù‚Ø§Ø¡Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ Ù„ÙƒÙ„ Ø´Ø®Øµ Ø¬Ø¯ÙŠØ¯ ÙŠØ¯Ø®Ù„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ù† Ø®Ù„Ø§Ù„ Ø±Ø§Ø¨Ø·Ùƒ!</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="rules-modal" class="modal">
    <div class="modal-content rules-modal-content">
        <span class="close-btn" onclick="closeModal('rules-modal')">&times;</span>
        <h2>âš–ï¸ Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø³ÙŠØ±ÙØ±</h2>
        <div class="rule-card"><h3>ğŸš« Ø§Ù„ØºØ´ ÙˆØ§Ù„Ù‡Ø§ÙƒØ§Øª</h3><p>ÙŠÙ…Ù†Ø¹ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠ Ø¨Ø±Ø§Ù…Ø¬ Ø®Ø§Ø±Ø¬ÙŠØ©.</p></div>
        <div class="rule-card"><h3>ğŸ—£ï¸ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù…</h3><p>ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø³Ø¨ Ø£Ùˆ Ø§Ù„ØªØ­Ø±Ø´.</p></div>
        <div class="rule-card"><h3>ğŸ—ï¸ Ø§Ù„Ø¨Ù†Ø§Ø¡</h3><p>ÙŠÙ…Ù†Ø¹ Ø§Ù„ØªØ®Ø±ÙŠØ¨.</p></div>
        <div class="rule-card"><h3>ğŸ“¢ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©</h3><p>ÙŠÙ…Ù†Ø¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª.</p></div>
    </div>
</div>

<script>
    // === Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù†Ø§ØµØ± ===
    const GAME_ITEMS = {
        bronze_key: {
            id: 'bronze_key',
            name: 'COPPER KEY',
            description: 'Ù…ÙØªØ§Ø­ Ù†Ø­Ø§Ø³ÙŠ Ø£Ø³Ø§Ø³ÙŠ ÙŠÙˆÙ…ÙŠ.',
            image: 'COPPERKEY.png',
            rarity: 'common',
            max_stack: 25000
        }
    };

    let isProcessingReferral = false; // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø§Ù„Ø³Ø±ÙŠØ¹

    document.body.onload = function() { 
        updateAuthUI(); 
        checkReferralSystem(); // ÙØ­Øµ Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    };

    // === Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø­Ø§Ù„Ø© ÙˆØ§Ù„Ø­Ù…Ø§ÙŠØ© ===
    function checkReferralSystem() {
        const urlParams = new URLSearchParams(window.location.search);
        const referrer = urlParams.get('ref');

        if (referrer && !isProcessingReferral) {
            isProcessingReferral = true;
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø§Ø¦Ø± Ø¬Ø¯ÙŠØ¯Ù‹Ø§
            const visitorId = getVisitorID();
            const lastReferrer = localStorage.getItem('last_referrer');

            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø§Ø¦Ø± Ù„Ù… ÙŠØ­ØªØ³Ø¨ Ø¥Ø­Ø§Ù„ØªÙ‡ Ù„Ø£Ø­Ø¯ Ù…Ù† Ù‚Ø¨Ù„
            if (!lastReferrer) {
                // Ù†Ù‚ÙˆÙ… Ø¨ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
                localStorage.setItem('last_referrer', referrer); // Ø­ÙØ¸ Ù„Ù…Ù†ØªÙ…Øª Ø§Ù„Ø¥Ø­Ø§Ù„Ø© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
                setCookie('last_ref', referrer, 365); // Ø­Ù…Ø§ÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©
                
                // Ø¥Ø¹Ø·Ø§Ø¡ Ø§Ù„Ù…ÙƒØ§ÙØ£Ø© Ù„Ù„Ù…Ø­ÙŠÙ„
                grantReferralReward(referrer);
            } else {
                console.log("This visitor already counted a referral.");
            }
            
            // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ù„Ø£Ù…Ø§Ù† (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            // window.history.replaceState({}, document.title, window.location.pathname);
        }
    }

    function grantReferralReward(referrerName) {
        let db = getDB();
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø­ÙŠÙ„ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        if (db[referrerName]) {
            // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…Ø­ÙŠÙ„ Ù„ÙŠØ³ Ù†ÙØ³ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø°ÙŠ Ø¯Ø®Ù„ (Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ØªØ­ÙŠÙ„ Ù†ÙØ³Ùƒ)
            const currentUser = getCurrentUser();
            if (currentUser === referrerName) return;

            addItemToInventoryForUser(referrerName, 'bronze_key', false);
            saveDB(db);
            console.log(`Referral success! ${referrerName} got a key.`);
            
            // Ø¥Ø´Ø¹Ø§Ø± (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ø­ÙŠÙ„ Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡ Ø­Ø§Ù„ÙŠØ§Ù‹)
            if (getCurrentUser() === referrerName) {
                showToast("ğŸ‰ Ù…ÙƒØ§ÙØ£Ø©! Ø´Ø®Øµ Ø¬Ø¯ÙŠØ¯ Ø¯Ø®Ù„ Ø¨Ø±Ø§Ø¨Ø·Ùƒ!", 'success');
                updateAuthUI();
                renderInventoryGrid(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø±Ø¶
            }
        }
    }

    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù‡ÙˆÙŠØ© Ø§Ù„Ø²Ø§Ø¦Ø± (Visitor ID)
    function getVisitorID() {
        let id = localStorage.getItem('visitor_uuid');
        if (!id) {
            id = 'vid_' + Math.random().toString(36).substr(2, 9) + Date.now();
            localStorage.setItem('visitor_uuid', id);
        }
        return id;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¹ÙŠÙ† (Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ø§Ù„Ø¥Ø­Ø§Ù„Ø©)
    function addItemToInventoryForUser(username, itemId, alertUser = false) {
        let db = getDB();
        if (!db[username]) db[username] = {};
        if (!db[username].inventory) db[username].inventory = [];

        let itemEntry = db[username].inventory.find(i => i.id === itemId);
        const itemData = GAME_ITEMS[itemId];
        const maxStack = itemData ? itemData.max_stack : 64;

        if (itemEntry) {
            if (itemEntry.count < maxStack) itemEntry.count++;
        } else {
            db[username].inventory.push({ id: itemId, count: 1 });
        }
    }

    // === Ù†Ø¸Ø§Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ===
    function getDB() { return JSON.parse(localStorage.getItem('4aikro_db')) || {}; }
    function saveDB(db) { localStorage.setItem('4aikro_db', JSON.stringify(db)); }
    
    function getCurrentUser() { return localStorage.getItem('4aikro_session'); }
    function setCurrentUser(username) { localStorage.setItem('4aikro_session', username); }

    // === Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø© ===
    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            let date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }

    function showToast(message, type = 'success') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.innerHTML = message;
        container.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }

    function updateAuthUI() {
        const container = document.getElementById('auth-btn-container');
        const username = getCurrentUser();
        const isLandingVisible = document.getElementById('landing-page').style.display !== 'none';
        
        if (username) {
            const db = getDB();
            const userObj = db[username] || {};
            const oldKeys = userObj.mc_keys ? userObj.mc_keys.length : 0;
            const newItems = userObj.inventory ? userObj.inventory.reduce((sum, item) => sum + item.count, 0) : 0;
            const totalCount = oldKeys + newItems;

            container.innerHTML = `
                <div class="user-btn profile-btn" onclick="openInventoryModal()">
                    ğŸ‘¤ ${username}
                    <span class="key-badge">ğŸ’ ${totalCount}</span>
                </div>
                <button class="user-btn logout-btn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
            `;

            const balanceNum = document.getElementById('key-balance-num');
            const balanceBox = document.getElementById('key-balance-box');
            if(balanceNum) balanceNum.innerText = totalCount;
            if(balanceBox) balanceBox.style.display = 'flex';
            
            // ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
            const refLinkInput = document.getElementById('ref-link-display');
            if(refLinkInput) {
                const baseUrl = window.location.origin + window.location.pathname;
                refLinkInput.value = `${baseUrl}?ref=${encodeURIComponent(username)}`;
            }

        } else {
            if (isLandingVisible) {
                container.innerHTML = `
                    <button class="user-btn" onclick="openModal('login-modal')">ğŸ”‘ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„</button>
                    <button class="user-btn" onclick="openModal('register-modal')" style="border-color:#cd7f32;">ğŸ“ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</button>
                `;
            } else {
                container.innerHTML = '';
            }
            
            const balanceBox = document.getElementById('key-balance-box');
            if(balanceBox) balanceBox.style.display = 'none';
        }
    }

    function openModal(id) { document.getElementById(id).style.display = 'block'; }
    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function openForgotModal() { closeModal('login-modal'); openModal('forgot-modal'); }

    function handleForgot() {
        const email = document.getElementById('forgot-email').value.trim();
        if(!email) { showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ", "error"); return; }

        let db = getDB();
        let foundUser = null;
        for(let user in db) {
            if(db[user].email === email) { foundUser = user; break; }
        }

        if(foundUser) {
            const code = db[foundUser].code;
            showToast(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨! Ø§Ù„ÙƒÙˆØ¯ Ù‡Ùˆ: <b style='color:var(--primary-color)'>${code}</b>`, 'success');
            closeModal('forgot-modal');
        } else {
            showToast("âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ù„Ø¯ÙŠÙ†Ø§.", "error");
        }
    }

    function handleLogin() {
        const name = document.getElementById('login-name').value.trim();
        const code = document.getElementById('login-code').value.trim();
        if (!name || !code) { showToast("Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯", "error"); return; }

        let db = getDB();
        if (db[name] && db[name].code === code) {
            setCurrentUser(name);
            closeModal('login-modal');
            updateAuthUI();
            initKeyLogic();
            showToast(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨ÙƒØŒ ${name} ğŸ‘‹`, 'success');
        } else {
            showToast("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„ÙƒÙˆØ¯", "error");
        }
    }

    function handleRegister() {
        const name = document.getElementById('reg-name').value.trim();
        const code = document.getElementById('reg-code').value.trim();
        const email = document.getElementById('reg-email').value.trim();

        if (!name || !code || !email) { showToast("Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©", "error"); return; }

        let db = getDB();
        if (db[name]) { showToast("Ø§Ù„Ø§Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹!", "error"); return; }

        db[name] = { code: code, email: email, inventory: [] };
        saveDB(db);

        setCurrentUser(name);
        closeModal('register-modal');
        updateAuthUI();
        initKeyLogic();
        showToast("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¨Ù†Ø¬Ø§Ø­! ğŸ‰");
    }

    function logout() {
        localStorage.removeItem('4aikro_session');
        updateAuthUI();
        initKeyLogic();
        closeModal('inventory-modal');
        showToast("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬");
    }

    // === Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ===
    function openInventoryModal() {
        const username = getCurrentUser();
        if (!username) return;

        let db = getDB();
        if (!db[username]) db[username] = {};
        if (!db[username].inventory) db[username].inventory = [];

        if (db[username].mc_keys && db[username].mc_keys.length > 0) {
            db[username].mc_keys.forEach(() => {
                addItemToInventory('bronze_key', false, false);
            });
            delete db[username].mc_keys;
            saveDB(db);
            updateAuthUI();
        }
        
        renderInventoryGrid();
        updateAuthUI(); // Ù„ØªØ­Ø¯ÙŠØ« Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø­Ø§Ù„Ø©
        openModal('inventory-modal');
    }

    function addItemToInventory(itemId, alertUser = true, checkMaxStack = true) {
        const username = getCurrentUser();
        let db = getDB();
        
        if (!db[username]) db[username] = {};
        if (!db[username].inventory) db[username].inventory = [];

        let itemEntry = db[username].inventory.find(i => i.id === itemId);
        const itemData = GAME_ITEMS[itemId];
        const maxStack = itemData ? itemData.max_stack : 64;

        if (itemEntry) {
            if (checkMaxStack && itemEntry.count >= maxStack) {
                if(alertUser) showToast(`âš ï¸ ÙˆØµÙ„Øª Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ (${maxStack})`, 'error');
                return;
            }
            itemEntry.count++;
        } else {
            db[username].inventory.push({ id: itemId, count: 1 });
        }

        saveDB(db);
        updateAuthUI();
        if(alertUser) showToast("ğŸ‰ ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù†ØµØ± Ù„Ù„Ù…Ø®Ø²ÙˆÙ†!");
    }

    function renderInventoryGrid() {
        const username = getCurrentUser();
        const db = getDB();
        const inventory = db[username]?.inventory || [];
        const grid = document.getElementById('inv-grid');
        const details = document.getElementById('inv-details');
        details.innerHTML = '<p class="inv-empty-msg">Ø§Ø®ØªØ± Ø¹Ù†ØµØ±Ø§Ù‹</p><div class="referral-box"><span class="referral-title">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ© Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</span><div class="referral-link-display"><input type="text" id="ref-link-display" class="referral-link-input" readonly><button class="referral-copy-btn" onclick="copyRefLink()">Ù†Ø³Ø®</button></div><p class="referral-info">Ø§Ø¯Ø¹Ù Ø£ØµØ¯Ù‚Ø§Ø¡Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ Ù„ÙƒÙ„ Ø´Ø®Øµ Ø¬Ø¯ÙŠØ¯ ÙŠØ¯Ø®Ù„ Ù…Ù† Ø±Ø§Ø¨Ø·Ùƒ!</p></div>';

        if (inventory.length === 0) {
            grid.innerHTML = '<p style="grid-column: 1/-1; text-align:center; color:#333; padding:20px;">Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙØ§Ø±Øº</p>';
            return;
        }

        grid.innerHTML = inventory.map((entry, index) => {
            const itemData = GAME_ITEMS[entry.id];
            if(!itemData) return '';
            return `
            <div class="inv-slot rarity-${itemData.rarity}" onclick="showItemDetails(${index})">
                <img src="${itemData.image}" alt="${itemData.name}">
                ${entry.count > 1 ? `<span class="item-count">x${entry.count}</span>` : ''}
            </div>
            `;
        }).join('');
    }

    function showItemDetails(index) {
        const username = getCurrentUser();
        const db = getDB();
        const entry = db[username].inventory[index];
        const itemData = GAME_ITEMS[entry.id];
        
        document.querySelectorAll('.inv-slot').forEach(el => el.classList.remove('selected'));
        document.querySelectorAll('.inv-slot')[index].classList.add('selected');

        const details = document.getElementById('inv-details');
        let color = '#fff'; let name = 'Ø¹Ø§Ø¯ÙŠ';
        if(itemData.rarity === 'rare') { color = 'var(--rarity-rare)'; name = 'Ù†Ø§Ø¯Ø±'; }

        details.innerHTML = `
            <img src="${itemData.image}" style="width:100px; height:100px; filter: drop-shadow(0 5px 15px ${color});">
            <h3 style="color:${color};">${itemData.name}</h3>
            <div class="rarity-text" style="color:${color};">${name}</div>
            <p>${itemData.description}</p>
            <div style="margin-top:15px; font-size:0.8em; color:#555;">Ø§Ù„ÙƒÙ…ÙŠØ©: ${entry.count} / ${itemData.max_stack}</div>
            <div class="referral-box" style="margin-top:20px;">
                <span class="referral-title">ğŸ”— Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©</span>
                <div class="referral-link-display">
                    <input type="text" id="ref-link-display" class="referral-link-input" readonly>
                    <button class="referral-copy-btn" onclick="copyRefLink()">Ù†Ø³Ø®</button>
                </div>
                <p class="referral-info">Ø§Ø¯Ø¹Ù ØµØ¯ÙŠÙ‚Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­ Ù…Ø¬Ø§Ù†ÙŠ!</p>
            </div>
        `;
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ù‚Ù„ Ø§Ù„Ø±Ø§Ø¨Ø·
        updateAuthUI();
    }
    
    function copyRefLink() {
        const input = document.getElementById('ref-link-display');
        if(input && input.value) {
            navigator.clipboard.writeText(input.value);
            showToast("ØªÙ… Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø¹ÙˆØ©! Ø´Ø§Ø±ÙƒÙ‡ Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ.", 'success');
        }
    }

    function openRulesModal() { openModal('rules-modal'); }

    function showPage(pageName) {
        document.getElementById('landing-page').style.display = 'none';
        document.getElementById('minecraft-page').style.display = 'none';
        document.getElementById('roblox-page').style.display = 'none';

        if (pageName === 'minecraft') {
            document.getElementById('minecraft-page').style.display = 'block';
            checkServerStatus();
            initKeyLogic();
            updateAuthUI(); 
            setTimeout(revealOnScroll, 100); 
        } else if (pageName === 'roblox') {
            document.getElementById('roblox-page').style.display = 'block';
            updateAuthUI(); 
        }
    }
    function goHome() {
        document.getElementById('landing-page').style.display = 'flex';
        document.getElementById('minecraft-page').style.display = 'none';
        document.getElementById('roblox-page').style.display = 'none';
        updateAuthUI();
    }

    const COOLDOWN_TIME = 24 * 60 * 60 * 1000; 
    let timerInterval;

    function initKeyLogic() {
        const claimBtn = document.getElementById('claim-key-btn');
        const displayArea = document.getElementById('key-display-area');
        
        if(!claimBtn) return;
        
        const username = getCurrentUser();

        if (!username) {
            claimBtn.disabled = false;
            claimBtn.innerText = "ğŸ”‘ Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ùƒ";
            claimBtn.onclick = () => openModal('login-modal');
            displayArea.style.display = 'none';
            return;
        }
        
        const lastClaim = localStorage.getItem(`mc_keyTime_${username}`);
        
        if (lastClaim) {
            const nextClaimTime = parseInt(lastClaim) + COOLDOWN_TIME;
            const now = new Date().getTime();
            
            if (now < nextClaimTime) {
                claimBtn.disabled = true;
                claimBtn.innerText = "â³ Ø§Ù†ØªØ¸Ø±";
                displayArea.style.display = 'block';
                startCountdown(nextClaimTime);
            } else {
                setupClaimable();
            }
        } else {
            setupClaimable();
        }
    }

    function setupClaimable() {
        const claimBtn = document.getElementById('claim-key-btn');
        if(!claimBtn) return;
        claimBtn.disabled = false;
        claimBtn.innerText = "ğŸ”‘ Ø§Ø­ØµÙ„ Ø¹Ù„Ù‰ Ù…ÙØªØ§Ø­Ùƒ";
        claimBtn.onclick = claimBronzeKey;
        document.getElementById('key-display-area').style.display = 'none';
    }

    function claimBronzeKey() {
        const username = getCurrentUser();
        if(!username) return;
        addItemToInventory('bronze_key');
        const now = new Date().getTime();
        localStorage.setItem(`mc_keyTime_${username}`, now);
        initKeyLogic(); 
    }

    function startCountdown(endTime) {
        clearInterval(timerInterval);
        const timerDisplay = document.getElementById('timer-display');
        function updateTimer() {
            const now = new Date().getTime();
            const distance = endTime - now;
            if (distance < 0) {
                clearInterval(timerInterval);
                setupClaimable();
            } else {
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                if(timerDisplay) timerDisplay.innerHTML = `${hours}Ø³ ${minutes}Ø¯ ${seconds}Ø«`;
            }
        }
        updateTimer();
        timerInterval = setInterval(updateTimer, 1000);
    }

    function copyIP() {
        navigator.clipboard.writeText(document.getElementById("server-ip").innerText);
        showToast("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø£ÙŠØ¨ÙŠ!", 'success');
    }

    function checkServerStatus() {
        const statusText = document.getElementById("status-text");
        const statusDot = document.getElementById("status-dot");
        const playerElement = document.getElementById("player-count");
        const versionElement = document.getElementById("server-version");

        statusText.innerText = "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù‚Ù‚...";
        statusText.classList.remove("status-online", "status-offline");
        statusDot.classList.remove("dot-online", "dot-offline");
        playerElement.innerText = "";
        versionElement.innerText = "";

        fetch("https://api.mcstatus.io/v2/status/java/cities-declare.gl.joinmc.link")
            .then(response => response.json())
            .then(data => {
                if (data && data.online === true) {
                    statusText.innerText = "ğŸŸ¢ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£ÙˆÙ†Ù„Ø§ÙŠÙ†";
                    statusText.classList.add("status-online");
                    statusDot.classList.add("dot-online");
                    playerElement.innerText = "Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†: " + data.players.online + " / " + data.players.max;
                    versionElement.innerText = "Ø§Ù„Ø¥ØµØ¯Ø§Ø±: " + data.version.name_clean;
                } else {
                    statusText.innerText = "ğŸ”´ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø£ÙˆÙÙ„Ø§ÙŠÙ†";
                    statusText.classList.add("status-offline");
                    statusDot.classList.add("dot-offline");
                }
            })
            .catch(error => {
                statusText.innerText = "âš ï¸ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
                statusText.classList.add("status-offline");
                statusDot.classList.add("dot-offline");
            });
    }

    function revealOnScroll() {
        const reveals = document.querySelectorAll(".section");
        reveals.forEach(element => {
            const windowHeight = window.innerHeight;
            const elementTop = element.getBoundingClientRect().top;
            if (elementTop < windowHeight - 150) {
                element.classList.add("visible");
            }
        });
    }

    window.addEventListener("scroll", revealOnScroll);

    scrollTopBtn = document.getElementById("scrollTopBtn");
    window.onscroll = function() { scrollFunction(); };

    function scrollFunction() {
      if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
        scrollTopBtn.style.display = "block";
      } else {
        scrollTopBtn.style.display = "none";
      }
    }

    function topFunction() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
</script>
</body>
</html>
